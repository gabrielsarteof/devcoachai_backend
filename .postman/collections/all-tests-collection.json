{
	"info": {
		"_postman_id": "master-test-collection-001",
		"name": "DevCoach AI - All Tests (Master)",
		"description": "🚀 **Master Test Collection** - Comprehensive API test suite\n\nThis collection provides automated testing for the DevCoach AI API with proper dependency management and execution ordering.\n\n**How to Use:**\n1. Select the appropriate environment (dev/staging/production)\n2. Click \"Run Collection\" in Postman\n3. All tests will execute in sequence with automatic token handling\n\n**Features:**\n- Automatic health checks before testing\n- Smart token management across requests\n- Detailed logging and error reporting\n- Execution statistics and summary reports\n- Global pre-request and test scripts\n\n**Requirements:**\n- API server must be running\n- Database must be accessible\n- Environment properly configured\n\n**Environment Variables (Auto-managed):**\n- `accessToken` - JWT access token\n- `refreshToken` - JWT refresh token\n- `userId` - Authenticated user ID\n- Additional context variables as needed",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "master-collection"
	},
	"item": [
		{
			"name": "🏥 0. Health Check",
			"description": "Verify API is running before starting tests",
			"item": [
				{
					"name": "API Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('API is healthy', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response time is acceptable', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(1000);",
									"});",
									"",
									"console.log('✅ API is running and healthy');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3333/health",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3333",
							"path": ["health"]
						},
						"description": "Check if API is running and accessible"
					}
				}
			]
		},
		{
			"name": "🔐 1. Authentication Module",
			"description": "Run authentication tests to establish session",
			"item": [
				{
					"name": "Register New User",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Generate unique test email",
									"const timestamp = Date.now();",
									"const testEmail = `test.user.${timestamp}@example.com`;",
									"pm.environment.set('testEmail', testEmail);",
									"",
									"console.log(`📧 Generated test email: ${testEmail}`);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('User registered successfully', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response contains tokens and user data', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('user');",
									"    pm.expect(responseJson.data).to.have.property('accessToken');",
									"    pm.expect(responseJson.data).to.have.property('refreshToken');",
									"});",
									"",
									"pm.test('Tokens saved to environment', function () {",
									"    const responseJson = pm.response.json();",
									"    const accessToken = responseJson.data.accessToken;",
									"    const refreshToken = responseJson.data.refreshToken;",
									"    const userId = responseJson.data.user.id;",
									"    ",
									"    pm.environment.set('accessToken', accessToken);",
									"    pm.environment.set('refreshToken', refreshToken);",
									"    pm.environment.set('userId', userId);",
									"    ",
									"    pm.expect(accessToken).to.be.a('string').and.not.empty;",
									"    pm.expect(refreshToken).to.be.a('string').and.not.empty;",
									"    pm.expect(userId).to.be.a('string').and.not.empty;",
									"});",
									"",
									"console.log('✅ User registered and authenticated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"TestPass@123\",\n  \"acceptTerms\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "register"]
						}
					}
				},
				{
					"name": "Get Current User Profile",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Profile retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Profile contains user data', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('user');",
									"    pm.expect(responseJson.data.user).to.have.property('id');",
									"    pm.expect(responseJson.data.user).to.have.property('email');",
									"    pm.expect(responseJson.data.user).to.have.property('name');",
									"    pm.expect(responseJson.data.user).to.not.have.property('password');",
									"});",
									"",
									"console.log('✅ User profile retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/auth/me",
							"host": ["{{baseUrl}}"],
							"path": ["auth", "me"]
						}
					}
				}
			]
		},
		{
			"name": "🏆 2. Challenges Module",
			"description": "Test challenges and code submission features",
			"item": [
				{
					"name": "List Available Challenges",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Challenges listed successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response contains challenges array', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('challenges');",
									"    pm.expect(responseJson.data.challenges).to.be.an('array');",
									"});",
									"",
									"// Store first challenge ID for later tests",
									"const challenges = pm.response.json().data.challenges;",
									"if (challenges.length > 0) {",
									"    pm.environment.set('challengeId', challenges[0].id);",
									"    console.log('✅ Stored challengeId:', challenges[0].id);",
									"}",
									"",
									"console.log('✅ Challenges module tested successfully');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/challenges?limit=5",
							"host": ["{{baseUrl}}"],
							"path": ["challenges"],
							"query": [
								{
									"key": "limit",
									"value": "5"
								}
							]
						},
						"description": "List available challenges (public endpoint)"
					}
				},
				{
					"name": "Get Challenge Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Challenge details retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Challenge has required fields', function () {",
									"    const challenge = pm.response.json().data.challenge;",
									"    pm.expect(challenge).to.have.property('id');",
									"    pm.expect(challenge).to.have.property('title');",
									"    pm.expect(challenge).to.have.property('difficulty');",
									"    pm.expect(challenge).to.have.property('category');",
									"    pm.expect(challenge).to.have.property('instructions');",
									"});",
									"",
									"console.log('✅ Challenge details retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/challenges/{{challengeId}}",
							"host": ["{{baseUrl}}"],
							"path": ["challenges", "{{challengeId}}"]
						},
						"description": "Get detailed challenge information"
					}
				},
				{
					"name": "Start Challenge Attempt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Attempt created successfully', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Attempt ID returned', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('attemptId');",
									"    ",
									"    // Store attempt ID",
									"    pm.environment.set('attemptId', responseJson.data.attemptId);",
									"    console.log('✅ Stored attemptId:', responseJson.data.attemptId);",
									"});",
									"",
									"console.log('✅ Challenge attempt started');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"javascript\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/challenges/{{challengeId}}/start",
							"host": ["{{baseUrl}}"],
							"path": ["challenges", "{{challengeId}}", "start"]
						},
						"description": "Start a new challenge attempt"
					}
				}
			]
		},
		{
			"name": "📊 3. Metrics Module",
			"description": "Test metrics tracking and session analytics features",
			"item": [
				{
					"name": "Track Coding Metrics",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Metrics tracked successfully', function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test('Response contains metrics data', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('metricSnapshot');",
									"    pm.expect(responseJson.data).to.have.property('calculation');",
									"    pm.expect(responseJson.data).to.have.property('riskAssessment');",
									"});",
									"",
									"console.log('✅ Metrics module tested successfully');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"attemptId\": \"{{attemptId}}\",\n  \"totalLines\": 100,\n  \"linesFromAI\": 30,\n  \"linesTyped\": 70,\n  \"copyPasteEvents\": 2,\n  \"deleteEvents\": 5,\n  \"testRuns\": 3,\n  \"testsPassed\": 2,\n  \"testsTotal\": 3,\n  \"checklistItems\": [{\"id\": \"c1\", \"label\": \"Test\", \"checked\": true, \"weight\": 1, \"category\": \"validation\"}],\n  \"sessionTime\": 300\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/metrics",
							"host": ["{{baseUrl}}"],
							"path": ["metrics"]
						},
						"description": "Track coding metrics for a challenge attempt"
					}
				},
				{
					"name": "Get Session Metrics",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Session metrics retrieved', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Session has required fields', function () {",
									"    const sessionData = pm.response.json().data;",
									"    pm.expect(sessionData).to.have.property('attempt');",
									"    pm.expect(sessionData).to.have.property('metrics');",
									"    pm.expect(sessionData).to.have.property('summary');",
									"    pm.expect(sessionData).to.have.property('userAverages');",
									"    pm.expect(sessionData).to.have.property('trends');",
									"});",
									"",
									"console.log('✅ Session metrics retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/metrics/session/{{attemptId}}",
							"host": ["{{baseUrl}}"],
							"path": ["metrics", "session", "{{attemptId}}"]
						},
						"description": "Get metrics for a specific attempt session"
					}
				}
			]
		},
		{
			"name": "🎮 4. Gamification Module",
			"description": "Test gamification features including badges, leaderboards, streaks, and notifications",
			"item": [
				{
					"name": "Get User Dashboard",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Dashboard retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Dashboard contains required data', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson).to.have.property('data');",
									"    const data = responseJson.data;",
									"    pm.expect(data).to.have.property('user');",
									"    pm.expect(data).to.have.property('badges');",
									"    pm.expect(data).to.have.property('streak');",
									"    pm.expect(data).to.have.property('ranking');",
									"});",
									"",
									"console.log('✅ User dashboard retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/dashboard",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "dashboard"]
						},
						"description": "Get user's gamification dashboard"
					}
				},
				{
					"name": "Get User Badges",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Badges retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response contains badges data', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson).to.have.property('data');",
									"    const data = responseJson.data;",
									"    pm.expect(data).to.have.property('unlocked');",
									"    pm.expect(data).to.have.property('locked');",
									"    pm.expect(data).to.have.property('stats');",
									"    pm.expect(data.unlocked).to.be.an('array');",
									"});",
									"",
									"console.log('✅ User badges retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/badges",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "badges"]
						},
						"description": "Get user's badge collection"
					}
				},
				{
					"name": "Get Global XP Leaderboard",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Leaderboard retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Leaderboard contains rankings', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('rankings');",
									"    pm.expect(responseJson.data.rankings).to.be.an('array');",
									"});",
									"",
									"console.log('✅ Global leaderboard retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/leaderboard?type=XP_TOTAL&scope=GLOBAL&period=ALL_TIME",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "leaderboard"],
							"query": [
								{
									"key": "type",
									"value": "XP_TOTAL"
								},
								{
									"key": "scope",
									"value": "GLOBAL"
								},
								{
									"key": "period",
									"value": "ALL_TIME"
								}
							]
						},
						"description": "Get global XP leaderboard"
					}
				},
				{
					"name": "Get Weekly Streak Leaderboard",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Weekly leaderboard retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Weekly leaderboard has proper structure', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('type', 'XP_WEEKLY');",
									"    pm.expect(responseJson.data).to.have.property('scope', 'GLOBAL');",
									"    pm.expect(responseJson.data).to.have.property('period', 'WEEKLY');",
									"});",
									"",
									"console.log('✅ Weekly leaderboard retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/leaderboard?type=XP_WEEKLY&scope=GLOBAL&period=WEEKLY",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "leaderboard"],
							"query": [
								{
									"key": "type",
									"value": "XP_WEEKLY"
								},
								{
									"key": "scope",
									"value": "GLOBAL"
								},
								{
									"key": "period",
									"value": "WEEKLY"
								}
							]
						},
						"description": "Get weekly streak leaderboard"
					}
				},
				{
					"name": "Get Streak Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Streak status retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Streak status contains required fields', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson).to.have.property('data');",
									"    const data = responseJson.data;",
									"    pm.expect(data).to.have.property('currentStreak');",
									"    pm.expect(data).to.have.property('longestStreak');",
									"    pm.expect(data).to.have.property('status');",
									"    pm.expect(data.currentStreak).to.be.a('number');",
									"    pm.expect(data.longestStreak).to.be.a('number');",
									"});",
									"",
									"console.log('✅ Streak status retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/streak",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "streak"]
						},
						"description": "Get user's streak status"
					}
				},
				{
					"name": "Get User Notifications",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Notifications retrieved successfully', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Notifications response has proper structure', function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson).to.have.property('success', true);",
									"    pm.expect(responseJson.data).to.have.property('notifications');",
									"    pm.expect(responseJson.data).to.have.property('unreadCount');",
									"    pm.expect(responseJson.data.notifications).to.be.an('array');",
									"});",
									"",
									"console.log('✅ User notifications retrieved');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/gamification/notifications?limit=10",
							"host": ["{{baseUrl}}"],
							"path": ["gamification", "notifications"],
							"query": [
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Get user's gamification notifications"
					}
				}
			]
		},
		{
			"name": "✅ 5. Final Summary",
			"description": "Generate test execution summary",
			"item": [
				{
					"name": "Test Summary Report",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Generate comprehensive test summary",
									"console.log('\\n' + '='.repeat(70));",
									"console.log('📊 TEST EXECUTION SUMMARY');",
									"console.log('='.repeat(70));",
									"",
									"const envName = pm.environment.get('environment') || 'Unknown';",
									"const apiUrl = pm.environment.get('baseUrl');",
									"const userIdFinal = pm.environment.get('userId');",
									"const accessTokenFinal = pm.environment.get('accessToken');",
									"const totalRequestsFinal = parseInt(pm.environment.get('totalRequests') || '0');",
									"const successfulRequestsFinal = parseInt(pm.environment.get('successfulRequests') || '0');",
									"const failedRequestsFinal = parseInt(pm.environment.get('failedRequests') || '0');",
									"",
									"console.log('\\n🌍 Environment Configuration:');",
									"console.log(`   Environment: ${envName}`);",
									"console.log(`   API URL: ${apiUrl}`);",
									"console.log(`   User ID: ${userIdFinal || 'Not set'}`);",
									"console.log(`   Auth Token: ${accessTokenFinal ? 'Set ✅' : 'Not set ❌'}`);",
									"",
									"console.log('\\n📊 Execution Statistics:');",
									"console.log(`   Total Requests: ${totalRequestsFinal}`);",
									"console.log(`   Successful: ${successfulRequestsFinal} ✅`);",
									"console.log(`   Failed: ${failedRequestsFinal} ❌`);",
									"",
									"if (totalRequestsFinal > 0) {",
									"    const successRate = ((successfulRequestsFinal / totalRequestsFinal) * 100).toFixed(2);",
									"    console.log(`   Success Rate: ${successRate}%`);",
									"}",
									"",
									"console.log('\\n📦 Test Modules:');",
									"console.log('   ✅ All configured modules executed');",
									"",
									"console.log('\\n' + '='.repeat(70));",
									"if (failedRequestsFinal === 0) {",
									"    console.log('🎉 All tests completed successfully!');",
									"} else {",
									"    console.log('⚠️  Some tests failed. Please review the results above.');",
									"}",
									"console.log('='.repeat(70) + '\\n');",
									"",
									"pm.test('Test suite completed', function () {",
									"    pm.expect(totalRequestsFinal).to.be.above(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "http://localhost:3333/health",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3333",
							"path": ["health"]
						},
						"description": "Final health check and summary generation"
					}
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// ============================================================",
					"// GLOBAL PRE-REQUEST SCRIPT",
					"// Runs before EVERY request in this collection",
					"// ============================================================",
					"",
					"// 1. Add common headers",
					"pm.request.headers.add({",
					"    key: 'User-Agent',",
					"    value: 'PostmanRuntime/DevCoachAI-MasterTests/1.0'",
					"});",
					"",
					"pm.request.headers.add({",
					"    key: 'Accept',",
					"    value: 'application/json'",
					"});",
					"",
					"// 2. Generate request tracking ID",
					"const timestamp = new Date().toISOString();",
					"const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;",
					"pm.environment.set('lastRequestTimestamp', timestamp);",
					"pm.environment.set('lastRequestId', requestId);",
					"",
					"pm.request.headers.add({",
					"    key: 'X-Request-ID',",
					"    value: requestId",
					"});",
					"",
					"// 3. Log request details",
					"const method = pm.request.method;",
					"const url = pm.request.url.toString();",
					"console.log(`\\n🚀 [${timestamp}] ${method} ${url}`);",
					"console.log(`   Request ID: ${requestId}`);",
					"",
					"// 4. Auto-inject authorization token if available",
					"const accessToken = pm.environment.get('accessToken');",
					"if (accessToken && accessToken !== '') {",
					"    // Check if Authorization header already exists",
					"    const hasAuthHeader = pm.request.headers.has('Authorization');",
					"    if (!hasAuthHeader) {",
					"        pm.request.headers.add({",
					"            key: 'Authorization',",
					"            value: `Bearer ${accessToken}`",
					"        });",
					"        console.log('   🔐 Auth token auto-injected');",
					"    }",
					"} else {",
					"    console.log('   ℹ️  No auth token available (expected for login/register)');",
					"}",
					"",
					"// 5. Log request body if present",
					"if (pm.request.body && pm.request.body.mode === 'raw') {",
					"    try {",
					"        const body = JSON.parse(pm.request.body.raw);",
					"        // Mask sensitive fields",
					"        if (body.password) body.password = '***';",
					"        if (body.refreshToken) body.refreshToken = '***';",
					"        console.log('   📦 Body:', JSON.stringify(body, null, 2));",
					"    } catch (e) {",
					"        console.log('   📦 Body: (non-JSON)');",
					"    }",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// ============================================================",
					"// GLOBAL TEST SCRIPT",
					"// Runs after EVERY request in this collection",
					"// ============================================================",
					"",
					"// 1. Log response details",
					"console.log(`📥 Response: ${pm.response.code} ${pm.response.status} (${pm.response.responseTime}ms)`);",
					"",
					"// 2. Universal validations for successful responses",
					"if (pm.response.code >= 200 && pm.response.code < 300) {",
					"    pm.test('[Global] Response time is acceptable', function () {",
					"        pm.expect(pm.response.responseTime).to.be.below(5000);",
					"    });",
					"    ",
					"    pm.test('[Global] Content-Type is JSON', function () {",
					"        const contentType = pm.response.headers.get('Content-Type');",
					"        if (contentType) {",
					"            pm.expect(contentType).to.include('application/json');",
					"        }",
					"    });",
					"}",
					"",
					"// 3. Handle error responses",
					"if (pm.response.code >= 400) {",
					"    console.log('   ⚠️  Error response detected');",
					"    ",
					"    try {",
					"        const jsonData = pm.response.json();",
					"        if (jsonData.message) {",
					"            console.log(`   Error message: ${jsonData.message}`);",
					"        }",
					"        if (jsonData.code) {",
					"            console.log(`   Error code: ${jsonData.code}`);",
					"        }",
					"        if (jsonData.errors) {",
					"            console.log(`   Validation errors:`, jsonData.errors);",
					"        }",
					"    } catch (e) {",
					"        console.log('   Could not parse error response');",
					"    }",
					"}",
					"",
					"// 4. Track execution statistics",
					"let totalRequests = parseInt(pm.environment.get('totalRequests') || '0');",
					"let successfulRequests = parseInt(pm.environment.get('successfulRequests') || '0');",
					"let failedRequests = parseInt(pm.environment.get('failedRequests') || '0');",
					"",
					"totalRequests++;",
					"if (pm.response.code >= 200 && pm.response.code < 400) {",
					"    successfulRequests++;",
					"} else {",
					"    failedRequests++;",
					"}",
					"",
					"pm.environment.set('totalRequests', totalRequests.toString());",
					"pm.environment.set('successfulRequests', successfulRequests.toString());",
					"pm.environment.set('failedRequests', failedRequests.toString());",
					"",
					"console.log(`   📊 Stats: ${successfulRequests}/${totalRequests} successful`);",
					"",
					"// 5. Log response body preview (first 200 chars)",
					"try {",
					"    const responseBody = pm.response.text();",
					"    if (responseBody && responseBody.length > 0) {",
					"        const preview = responseBody.substring(0, 200);",
					"        console.log(`   📄 Response preview: ${preview}${responseBody.length > 200 ? '...' : ''}`);",
					"    }",
					"} catch (e) {",
					"    console.log('   📄 Response: (could not preview)');",
					"}"
				]
			}
		}
	]
}
